CREATE OR REPLACE PROCEDURE AUTH_DB2_ZOS_REPORT.USP_LATECERTLIST_PARA (IN P_DB_CMDB_NAME VARCHAR(100), IN P_ZUST_ORGA VARCHAR(50), IN P_SACHGEBIET VARCHAR(50), IN P_SNAPSHOT VARCHAR(50) )
  SPECIFIC USP_LATECERTLIST_PARA
  DYNAMIC RESULT SETS 1
  LANGUAGE SQL
  NOT DETERMINISTIC
  EXTERNAL ACTION
  MODIFIES SQL DATA
  CALLED ON NULL INPUT
  INHERIT SPECIAL REGISTERS
  OLD SAVEPOINT LEVEL
BEGIN 
  	DECLARE cur CURSOR WITH RETURN FOR 
  	SELECT distinct RPAD(VARCHAR_FORMAT(s.SNAP_TS,'DD.MM.YYYY HH24:MI:SS'),35) LATECERT
	FROM AUTH_DB2_ZOS_REPORT.VW_REPORT_DB2_ZOS_TABAUTH s 
	WHERE TRIM(s.SYSPLEX_CMDB_NAME) = TRIM(P_DB_CMDB_NAME)
		AND TRIM(s.zust_orga)=TRIM(P_ZUST_ORGA)
		AND TRIM(s.sachgebiet)=TRIM(P_SACHGEBIET)
		AND VARCHAR_FORMAT(s.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') < TRIM(P_SNAPSHOT)
	GROUP BY VARCHAR_FORMAT(s.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') 
	UNION ALL
	SELECT NULL LateCert 
	FROM sysibm.sysdummy1
	ORDER BY 1 DESC;

  OPEN cur;
END