CREATE OR REPLACE PROCEDURE AUTH_DB2_ZOS_REPORT.USP_SACHGEBIET_PARA ( IN P_DB_CMDB_NAME VARCHAR(100), IN P_ZUST_ORGA VARCHAR(50) )
  SPECIFIC USP_SACHGEBIET_PARA
  DYNAMIC RESULT SETS 1
  LANGUAGE SQL
  NOT DETERMINISTIC
  EXTERNAL ACTION
  MODIFIES SQL DATA
  CALLED ON NULL INPUT
  INHERIT SPECIAL REGISTERS
  OLD SAVEPOINT LEVEL
BEGIN 
  DECLARE cur CURSOR WITH RETURN FOR
 	SELECT DISTINCT ISNULL(sg.sachgebiet,RPAD(s.sachgebiet,43))  AS SACHGEBIET_NAME, 
 					s.sachgebiet
	FROM AUTH_DB2_ZOS_REPORT.VW_REPORT_DB2_ZOS_TABAUTH s
	LEFT JOIN 	(SELECT  t.HOSTLOESCHEN, RPAD(SUBSTRING(LISTAGG(TRIM(t.name),','),1,41)
	                                         ,case when 41-LENGTH(LISTAGG(TRIM(t.name),',')) < LENGTH(LISTAGG(TRIM(t.name),',')) then LENGTH(LISTAGG(TRIM(t.name),',')) 
											   else  41-LENGTH(LISTAGG(TRIM(t.name),',')) end )
											   as SACHGEBIET 
				FROM AUTH_DB2_ZOS_REPORT.VW_REPORT_DB2_ZOS_TAVERASACHGEBIET t  
				GROUP BY t.HOSTLOESCHEN) sg
		ON sg.HOSTLOESCHEN=s.sachgebiet
	WHERE TRIM(s.SYSPLEX_CMDB_NAME)= TRIM(P_DB_CMDB_NAME)		
		AND TRIM(s.zust_orga)= TRIM(P_ZUST_ORGA)
	ORDER BY 1;
		
	OPEN cur;
END