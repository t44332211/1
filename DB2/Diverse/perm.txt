WITH dbperm as (
--unpivot for db_permission 
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 	   
	   'BINDADD' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.BINDADDAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE,
	   'CONNECT' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.CONNECTAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
		'CREATETAB' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.CREATETABAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE,
		'DBADM' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.DBADMAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'EXTERNALROUTINE' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.EXTERNALROUTINEAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE,
	   'IMPLSCHEMA' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.IMPLSCHEMAAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'LOAD' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.LOADAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'NOFENCE' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.NOFENCEAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'QUIESCECONNECT' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.QUIESCECONNECTAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'LIBRARYADM' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.LIBRARYADMAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE,
	   'SECURITYADM' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.SECURITYADMAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'SQLADM' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.SQLADMAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'WLMADM' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.WLMADMAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'EXPLAIN' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.EXPLAINAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'DATAACCESS' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.DATAACCESSAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'ACCESSCTRL' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.ACCESSCTRLAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE,
	'CREATESECURE' PRIVILAGENAME, 'DATABASE' TABLE_TYPE, '*' SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_DBAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND  sp.CREATESECUREAUTH != 'N'
)
, tabperm as (
SELECT sp.DB_CMDB_NAME, sp.GRANTEE, sp.SNAP_TS, 
	   CASE sp.GRANTEETYPE 	WHEN 'R' THEN 'DATABASE_ROLE'
	   				    	WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'CONTROL' PRIVILAGENAME, 
	   'TABLE' TABLE_TYPE, 
	   sp.TABSCHEMA SCHEMANAME, 
	   sp.TABNAME OBJECTNAME,
	   '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_TABAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.CONTROLAUTH != 'N'
UNION ALL
SELECT sp.DB_CMDB_NAME, sp.GRANTEE, sp.SNAP_TS, 
	   CASE sp.GRANTEETYPE 	WHEN 'R' THEN 'DATABASE_ROLE'
	   				    	WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE,
	   'ALTER' PRIVILAGENAME, 
	   'TABLE' TABLE_TYPE, 
	   sp.TABSCHEMA SCHEMANAME, 
	   sp.TABNAME OBJECTNAME,
	   '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_TABAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.ALTERAUTH != 'N'   
UNION ALL
SELECT sp.DB_CMDB_NAME, sp.GRANTEE, sp.SNAP_TS, 
	   CASE sp.GRANTEETYPE 	WHEN 'R' THEN 'DATABASE_ROLE'
	   				    	WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE,
	   'DELETE' PRIVILAGENAME, 
	   'TABLE' TABLE_TYPE, 
	   sp.TABSCHEMA SCHEMANAME, 
	   sp.TABNAME OBJECTNAME,
	   '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_TABAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.DELETEAUTH != 'N'  
UNION ALL
SELECT sp.DB_CMDB_NAME, sp.GRANTEE, sp.SNAP_TS, 
	   CASE sp.GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'INDEX' PRIVILAGENAME, 
	   'TABLE' TABLE_TYPE, 
	   sp.TABSCHEMA SCHEMANAME, 
	   sp.TABNAME OBJECTNAME,
	   '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_TABAUTH sp

WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.INDEXAUTH != 'N'  
UNION ALL
SELECT sp.DB_CMDB_NAME, sp.GRANTEE, sp.SNAP_TS,  
	   CASE sp.GRANTEETYPE 	WHEN 'R' THEN 'DATABASE_ROLE'
	   				    	WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE,
	   'INSERT' PRIVILAGENAME, 
	   'TABLE' TABLE_TYPE, 
	   sp.TABSCHEMA SCHEMANAME, 
	   sp.TABNAME OBJECTNAME,
	   '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_TABAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.INSERTAUTH != 'N'  
UNION ALL
SELECT sp.DB_CMDB_NAME, sp.GRANTEE, sp.SNAP_TS,  
	   CASE sp.GRANTEETYPE 	WHEN 'R' THEN 'DATABASE_ROLE'
	   				    	WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE,
	   'REF' PRIVILAGENAME, 
	   'TABLE' TABLE_TYPE, 
	   sp.TABSCHEMA SCHEMANAME, 
	   sp.TABNAME OBJECTNAME,
	   '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_TABAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.REFAUTH != 'N'  
UNION ALL
SELECT sp.DB_CMDB_NAME, sp.GRANTEE, sp.SNAP_TS, 
	   CASE sp.GRANTEETYPE 	WHEN 'R' THEN 'DATABASE_ROLE'
	   				    	WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE,
	   'SELECT' PRIVILAGENAME, 
	   'TABLE' TABLE_TYPE, 
	   sp.TABSCHEMA SCHEMANAME, 
	   sp.TABNAME OBJECTNAME,
	   '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_TABAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.SELECTAUTH != 'N'  
UNION ALL
SELECT sp.DB_CMDB_NAME, sp.GRANTEE, sp.SNAP_TS,  
	   CASE sp.GRANTEETYPE 	WHEN 'R' THEN 'DATABASE_ROLE'
	   				    	WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'UPDATE' PRIVILAGENAME, 
	   'TABLE' TABLE_TYPE, 
	   sp.TABSCHEMA SCHEMANAME, 
	   sp.TABNAME OBJECTNAME,
	   '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_TABAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.UPDATEAUTH != 'N'
),
schperm as (
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'ALTERIN' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.ALTERINAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'CREATEIN' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.CREATEINAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'DROPIN' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.DROPINAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'SELECTIN' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.SELECTINAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'INSERTIN' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.INSERTINAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE,  sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'UPDATEIN' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.UPDATEINAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'DELETEIN' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.DELETEINAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE,  sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'EXECUTEIN' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.EXECUTEINAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'SCHEMAADM' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.SCHEMAADMAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'ACCESSCTRL' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.ACCESSCTRLAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'DATAACCESS' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.DATAACCESSAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'LOAD' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.LOADAUTH != 'N'
UNION ALL
SELECT DB_CMDB_NAME, GRANTEE, sp.SNAP_TS,
	   CASE GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'SCHEMARCAC' PRIVILAGENAME, 'SCHEMA' TABLE_TYPE, sp.SCHEMANAME, '*' OBJECTNAME, '*' COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_SCHEMAAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
     AND sp.SCHEMARCACAUTH != 'N'
),
colperm as (
SELECT sp. DB_CMDB_NAME, sp.GRANTEE, sp.TIMESTAMP SNAP_TS,
	   CASE sp.GRANTEETYPE 	WHEN 'R' THEN 'DATABASE_ROLE'
	   				    	WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   'SELECT' PRIVILAGENAME, 
	   'TABLE' TABLE_TYPE, 
	   sp.TABSCHEMA SCHEMANAME, 
	   sp.TABNAME OBJECTNAME,
	   sp.COLNAME COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_COLAUTH sp
WHERE trim(sp.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
     AND VARCHAR_FORMAT(sp.TIMESTAMP,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')
)
 SELECT rol.GRANTEE USERNAME, 
		CASE rol.GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
		 				    WHEN 'U' THEN 'DATABASE_USER'
		ELSE NULL END USERTYPE, 
		rol.ROLENAME,
		'GRANT' ACCESSTYPE,
		dbperm.PRIVILAGENAME,
		dbperm.TABLE_TYPE,
		dbperm.SCHEMANAME,
		dbperm.OBJECTNAME,
		dbperm.COLUMNNAME
 FROM AUTH_REPORT.VW_REPORT_DB2_LUW_ROLEAUTH rol
  INNER JOIN dbperm  
   ON trim(rol.DB_CMDB_NAME) = trim(dbperm.DB_CMDB_NAME)
   		AND rol.SNAP_TS = dbperm.SNAP_TS
   		AND (rol.GRANTEE = dbperm.GRANTEE OR rol.ROLENAME  = dbperm.GRANTEE)
 WHERE trim(rol.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
    AND VARCHAR_FORMAT(rol.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')    
 UNION ALL
 SELECT rol.GRANTEE USERNAME, 
	   CASE rol.GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   rol.ROLENAME,
	   'GRANT' ACCESSTYPE,
	   tabperm.PRIVILAGENAME,
	   tabperm.TABLE_TYPE,
	   tabperm.SCHEMANAME,
	   tabperm.OBJECTNAME,
	   tabperm.COLUMNNAME
 FROM AUTH_REPORT.VW_REPORT_DB2_LUW_ROLEAUTH rol
 INNER JOIN tabperm  
   ON trim(rol.DB_CMDB_NAME) = trim(tabperm.DB_CMDB_NAME)
   		AND rol.SNAP_TS = tabperm.SNAP_TS
   		AND (rol.GRANTEE = tabperm.GRANTEE OR rol.ROLENAME  = tabperm.GRANTEE)
 WHERE trim(rol.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
    AND VARCHAR_FORMAT(rol.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24')  
 UNION ALL
  SELECT rol.GRANTEE USERNAME, 
	   CASE rol.GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   rol.ROLENAME,
	   'GRANT' ACCESSTYPE,
	   schperm.PRIVILAGENAME,
	   schperm.TABLE_TYPE,
	   schperm.SCHEMANAME,
	   schperm.OBJECTNAME,
	   schperm.COLUMNNAME
 FROM AUTH_REPORT.VW_REPORT_DB2_LUW_ROLEAUTH rol
 INNER JOIN schperm  
   ON trim(rol.DB_CMDB_NAME) = trim(schperm.DB_CMDB_NAME)
   		AND rol.SNAP_TS = schperm.SNAP_TS
   		AND (rol.GRANTEE = schperm.GRANTEE OR rol.ROLENAME  = schperm.GRANTEE)
 WHERE trim(rol.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
    AND VARCHAR_FORMAT(rol.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24') 
UNION ALL
SELECT rol.GRANTEE USERNAME, 
	   CASE rol.GRANTEETYPE WHEN 'R' THEN 'DATABASE_ROLE'
	   				    WHEN 'U' THEN 'DATABASE_USER'
	   ELSE NULL END USERTYPE, 
	   rol.ROLENAME,
	   'GRANT' ACCESSTYPE,
	   colperm.PRIVILAGENAME,
	   colperm.TABLE_TYPE,
	   colperm.SCHEMANAME,
	   colperm.OBJECTNAME,
	   ISNULL(colperm.COLUMNNAME,'*') COLUMNNAME
FROM AUTH_REPORT.VW_REPORT_DB2_LUW_ROLEAUTH rol
INNER JOIN colperm  
	ON trim(rol.DB_CMDB_NAME) = trim(colperm.DB_CMDB_NAME)
   		AND rol.SNAP_TS = colperm.SNAP_TS
   		AND (rol.GRANTEE = colperm.GRANTEE OR rol.ROLENAME  = colperm.GRANTEE)
WHERE trim(rol.DB_CMDB_NAME) = trim('DINDWHM in DBDWHMIN auf SDB00060')
    AND VARCHAR_FORMAT(rol.SNAP_TS,'DD.MM.YYYY HH24:MI:SS') = TRIM('15.07.2025 04:00:24') 
 ORDER BY COLUMNNAME DESC