CREATE OR REPLACE PROCEDURE AUTH_DB2_ZOS_REPORT.USP_ORGUNIT_PARA ( IN P_DB_CMDB_NAME VARCHAR(100), IN P_USERID VARCHAR(20) )
  SPECIFIC USP_ORGUNIT_PARA
  DYNAMIC RESULT SETS 1
  LANGUAGE SQL
  NOT DETERMINISTIC
  EXTERNAL ACTION
  MODIFIES SQL DATA
  CALLED ON NULL INPUT
  INHERIT SPECIAL REGISTERS
  OLD SAVEPOINT LEVEL
BEGIN 
  DECLARE cur CURSOR WITH RETURN FOR

    SELECT R_GROUP  AS ORGUNIT FROM AUTH_DB2_ZOS_REPORT.VW_AUTH_DB2_ZOS_SACHGEBIET AS S
WHERE STATE != 'AB' AND (
--R_GROUP = MSSQL.UDF_GET_ORGA_BY_USER(P_USERID) OR  
1 = (SELECT 1 FROM AUTH_DB2_ZOS_REPORT.VW_DB2_ZOS_ADMINS WHERE USERID IN (P_USERID, 'LAN\' || P_USERID) FETCH FIRST 1 ROW ONLY) OR
S.DATA_ENABLER_1 = P_USERID OR
		S.DATA_ENABLER_2 = P_USERID OR
		S.DATA_ENABLER_3 = P_USERID OR
		S.DATA_OWNER = P_USERID OR
		S.DATA_STEWARD_1 = P_USERID OR
		S.DATA_STEWARD_2 = P_USERID OR
		S.DATA_STEWARD_3 = P_USERID
    )
GROUP BY R_GROUP
ORDER BY R_GROUP;
 		
   SET P_USERID = UPPER(P_USERID);
   IF (SELECT INSTR(P_USERID,'LAN\') FROM SYSIBM.SYSDUMMY1) > 0
 THEN
   SET P_USERID = SUBSTRING(UPPER(P_USERID),5); -- CUT 'LAN\' FROM USERID
 ELSE
    SET P_USERID = UPPER(P_USERID);
 END IF;
 
	OPEN cur;
  -- Optional: exception expressions
  -- EXCEPTION 
  -- WHEN { exception-condition } THEN { statement; } ... { statement; } 
  -- ... 
  -- WHEN { exception-condition } THEN { statement; } ... { statement; } 
END
